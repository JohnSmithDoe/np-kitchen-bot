<ion-modal
  [isOpen]="
    (rxState$ | async)?.isEditing === true &&
    (rxState$ | async)?.listId === '_tasks'
  "
  (didDismiss)="closedDialog()"
>
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="cancelChanges()"
            >{{ 'edit-item.dialog.button.close' | translate }}
          </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button
            (click)="submitChanges()"
            [disabled]="
              nameControl.hasError('duplicate') || nameControl.hasError('empty')
            "
            >{{
              (rxState$ | async)?.saveButtonText ?? '' | translate
            }}</ion-button
          >
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content #ionContent>
      <h3 class="ion-padding-start">
        {{ (rxState$ | async)?.dialogTitle ?? '' | translate }}
      </h3>
      <ion-list>
        <ion-item lines="none">
          <ion-input
            label="{{ 'edit.item.dialog.name' | translate }}"
            placeholder="{{ 'edit.item.dialog.name.placeholder' | translate }}"
            [formControl]="nameControl"
            [errorText]="getErrorText() | translate"
          ></ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            type="number"
            class="ion-text-end"
            label="PrioritÃ¤t"
            [clearOnEdit]="true"
            [ngModel]="(rxItem$ | async)?.prio"
            (ionInput)="updatePrio($event)"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            label="{{ 'edit.item.dialog.dueAt' | translate }}"
            class="trigger ion-text-end"
            [ngModel]="
              (rxItem$ | async)?.dueAt ?? ''
                | date: undefined : undefined : 'de-DE'
            "
            type="date_event"
            id="open_cal"
          ></ion-input>
          <ion-modal
            trigger="open_cal"
            [keepContentsMounted]="true"
            [initialBreakpoint]="0.68"
          >
            <ng-template>
              <ion-datetime
                presentation="date"
                mode="md"
                (ionChange)="updateDueAt($event)"
                [value]="(rxItem$ | async)?.dueAt"
                [showDefaultButtons]="true"
                [showClearButton]="true"
              ></ion-datetime>
            </ng-template>
          </ion-modal>
        </ion-item>
        <ion-item button (click)="showCategoryDialog()">
          <ion-label class="ion-text-wrap">
            {{ 'edit.item.dialog.categories' | translate }}
            @for (cat of (rxItem$ | async)?.category; track cat) {
              <ion-chip color="category">
                <ion-label class="ion-text-wrap">{{ cat }}</ion-label>
                <ion-icon
                  name="close-circle"
                  (click)="removeCategory(cat); $event.stopPropagation()"
                ></ion-icon>
              </ion-chip>
            } @empty {
              {{ 'edit.item.dialog.categories.empty' | translate }}
            }
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>

    <app-categories-dialog></app-categories-dialog>
  </ng-template>
</ion-modal>
