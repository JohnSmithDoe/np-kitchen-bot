<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cancel.emit()">{{
        'edit-item.dialog.button.close' | translate
      }}</ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button (click)="submitChanges()">{{ saveButtonText }}</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <h3 class="ion-padding-start">{{ dialogTitle }}</h3>
  <ion-list>
    <ion-item>
      <ion-input
        label="{{ 'edit.item.dialog.name' | translate }}"
        placeholder="{{ 'edit.item.dialog.name.placeholder' | translate }}"
        [(ngModel)]="nameValue"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-input
        type="number"
        class="ion-text-end"
        label="Menge"
        [clearOnEdit]="true"
        [(ngModel)]="quantityValue"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-input
        type="number"
        class="ion-text-end"
        label="Mindestmenge"
        [clearOnEdit]="true"
        [(ngModel)]="minAmountValue"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-input
        label="{{ 'edit.item.dialog.mhd' | translate }}"
        class="trigger ion-text-end"
        [ngModel]="bestBeforeDate ?? '' | date: undefined : undefined : 'de-DE'"
        type="date_event"
        id="open_cal"
      ></ion-input>
      <ion-modal
        trigger="open_cal"
        [keepContentsMounted]="true"
        [initialBreakpoint]="0.65"
      >
        <ng-template>
          <ion-datetime
            presentation="date"
            mode="md"
            (ionChange)="datePick($event)"
            [value]="bestBeforeDate"
            [showDefaultButtons]="true"
            [showClearButton]="true"
          ></ion-datetime>
        </ng-template>
      </ion-modal>
    </ion-item>

    <ion-item button (click)="selectCategories = true">
      <ion-label class="ion-text-wrap">
        {{ 'edit.item.dialog.categories' | translate }}
        @for (cat of categoryValue; track cat) {
          <ion-chip color="category">
            <!--                <ion-avatar>-->
            <!--                  <img alt="Image of the category" src="assets/avatar.svg"/>-->
            <!--                </ion-avatar>-->
            <ion-label class="ion-text-wrap">{{ cat }}</ion-label>
            <ion-icon
              name="close-circle"
              (click)="removeCategory(cat); $event.stopPropagation()"
            ></ion-icon>
          </ion-chip>
        } @empty {
          {{ 'edit.item.dialog.categories.empty' | translate }}
        }
      </ion-label>
    </ion-item>
  </ion-list>
</ion-content>

<ion-modal [isOpen]="selectCategories" (didDismiss)="selectCategories = false">
  <ng-template>
    <app-categories-dialog
      [item]=""
      [categories]="categories"
      (confirm)="setCategories($event)"
      (cancel)="selectCategories = false"
    ></app-categories-dialog>
  </ng-template>
</ion-modal>
