<app-page-header
  color="shopping"
  label="{{'page-title.shoppinglist' | translate}}"
  [disabled]="!!(rxSearchResult$ | async)?.exactMatch"
  (addItem)="showCreateDialog()"
>
  <app-item-list-searchbar
    [query]="(rxState$ | async)?.searchQuery"
    (queryChange)="searchFor($event)"
    (hitEnter)="addItemFromSearch()"
  ></app-item-list-searchbar>
  <app-item-list-toolbar
    (selectDisplayMode)="setDisplayMode($event)"
  ></app-item-list-toolbar>
</app-page-header>

<ion-content>
  <app-item-list-quickadd
    color="shopping"
    listName="{{'list-header.shoppinglist' | translate}}"
    [showQuickAdd]="(rxSearchResult$ | async)?.showQuickAdd"
    [showQuickAddGlobal]="(rxSearchResult$ | async)?.showQuickAddGlobal"
    [quickAddLabel]="(rxSearchResult$ | async)?.searchTerm"
    (quickAddItem)="addItemFromSearch()"
    (quickCreateGlobal)="showCreateGlobalDialog()"
  ></app-item-list-quickadd>

  <app-item-list
    #shoppinglistComponent
    headerColor="shopping"
    header="{{'list-header.shoppinglist' | translate}}"
    [mode]="(rxState$ | async)?.mode ?? 'alphabetical'"
    [items]="(rxItems$ | async)"
    [categories]="(rxCategories$ | async)"
    [itemTemplate]="shoppingItem"
    (selectCategory)="selectCategory($event)"
  ></app-item-list>
  <ng-template #shoppingItem let-item>
    <app-shopping-item
      [item]="item"
      [itemList]="shoppinglistComponent"
      (selectItem)="showEditDialog(item)"
      (deleteItem)="removeItem(item)"
      (increment)="changeQuantity(item, +1)"
      (decrement)="changeQuantity(item, -1)"
      (cartItem)="buyItem(item)"
    ></app-shopping-item>
  </ng-template>

  <app-item-list-empty
    [isEmptyList]="!((rxItems$ | async)?.length)"
    [isSearching]="(rxSearchResult$ |async)?.hasSearchTerm"
    [searchTerm]="(rxSearchResult$ |async)?.searchTerm"
    (emptyItem)="showCreateDialog()"
  ></app-item-list-empty>

  <!--  &lt;!&ndash;  storage search results&ndash;&gt;-->
  <!--  @if (searchResult?.storageItems?.length) {-->
  <!--  <app-item-list-->
  <!--    header="{{'list-header.storage.search' | translate}}"-->
  <!--    headerColor="storage"-->
  <!--    [items]="searchResult?.storageItems??[]"-->
  <!--    [itemTemplate]="storageItem"-->
  <!--  ></app-item-list>-->
  <!--  <ng-template #storageItem let-item>-->
  <!--    <app-text-item-->
  <!--      color="storage"-->
  <!--      class="tinted"-->
  <!--      [label]="item.name"-->
  <!--      [note]="item | appCategories"-->
  <!--      [helper]="'item-helper.search' | translate"-->
  <!--      (selectItem)="addStorageItem(item)"-->
  <!--    ></app-text-item>-->
  <!--  </ng-template>-->
  <!--  }-->
  <!--  global search result-->
  @if ((rxSearchResult$| async)?.globalItems?.length) {
  <app-item-list
    header="{{'list-header.global.search' | translate}}"
    headerColor="global"
    [items]="(rxSearchResult$| async)?.globalItems??[]"
    [itemTemplate]="globalItem"
  ></app-item-list>
  <ng-template #globalItem let-item>
    <app-text-item
      color="global"
      class="tinted"
      [label]="item.name"
      [note]="item | appCategories"
      [helper]="'item-helper.search' | translate"
      (selectItem)="createAndAddGlobalItem(item)"
    ></app-text-item>
  </ng-template>
  }
</ion-content>

<ion-modal
  [isOpen]="(rxState$ | async)?.isEditing === true"
  (didDismiss)="closeEditDialog()"
>
  <ng-template>
    <app-edit-shopping-item-dialog
      [mode]="(rxState$|async)?.editMode ?? 'create'"
      (cancel)="closeEditDialog()"
      (saveItem)="updateItem($event)"
      [item]="(rxState$|async)?.data"
      [categories]="(rxCategories$ | async) ?? []"
    ></app-edit-shopping-item-dialog>
  </ng-template>
</ion-modal>

<ion-modal
  [isOpen]="(rxState$|async)?.isCreating === true"
  (didDismiss)="closeCreateGlobalDialog()"
>
  <ng-template>
    <app-edit-global-item-dialog
      (cancel)="closeCreateGlobalDialog()"
      (saveItem)="createAndAddGlobalItem($event)"
      [item]="(rxState$|async)?.data"
      [categories]="(rxCategories$|async)??[]"
    ></app-edit-global-item-dialog>
  </ng-template>
</ion-modal>
